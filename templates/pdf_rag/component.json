{
  "identifier": "pdf-rag",
  "upstream": null,
  "cache": true,
  "status": null,
  "build_variables": null,
  "build_template": null,
  "template": {
    "identifier": "pdf-rag",
    "upstream": null,
    "cache": true,
    "status": "ready",
    "build_variables": null,
    "build_template": null,
    "components": [
      "?Table:<var:table_name>",
      "?Listener:split_image",
      "?Listener:chunker",
      "?VectorIndex:vector-index",
      "?Rag:rag"
    ],
    "link": null,
    "_path": "superduper.components.application.Application",
    "version": 0,
    "_builds": {
      "Table:<var:table_name>": {
        "upstream": null,
        "cache": true,
        "status": "ready",
        "build_variables": null,
        "build_template": null,
        "fields": {
          "url": "str",
          "file": "file"
        },
        "primary_id": "id",
        "data": null,
        "path": null,
        "component": false,
        "_path": "superduper.components.table.Table",
        "version": 0
      },
      "ObjectModel:split_image": {
        "upstream": null,
        "cache": true,
        "status": "ready",
        "build_variables": null,
        "build_template": null,
        "datatype": "file",
        "model_update_kwargs": {},
        "predict_kwargs": {},
        "compute_kwargs": {},
        "validation": null,
        "metric_values": {},
        "num_workers": 0,
        "serve": false,
        "trainer": null,
        "object": "&:blob:6f9bcf7166d47352a320de7bda96fe8272641bf6669ff835219d5451df548669",
        "method": null,
        "_path": "superduper.components.model.ObjectModel",
        "version": 0
      },
      "Listener:split_image": {
        "upstream": null,
        "cache": true,
        "status": "ready",
        "build_variables": null,
        "build_template": null,
        "cdc_table": "<var:table_name>",
        "key": "file",
        "model": "?ObjectModel:split_image",
        "predict_kwargs": {},
        "select": {
          "_path": "superduper.base.query.parse_query",
          "documents": [],
          "query": "<var:table_name>"
        },
        "flatten": true,
        "_path": "superduper.components.listener.Listener",
        "version": 0
      },
      "ObjectModel:chunk": {
        "upstream": null,
        "cache": true,
        "status": "ready",
        "build_variables": null,
        "build_template": null,
        "datatype": "json",
        "model_update_kwargs": {},
        "predict_kwargs": {},
        "compute_kwargs": {},
        "validation": null,
        "metric_values": {},
        "num_workers": 0,
        "serve": false,
        "trainer": null,
        "object": "&:blob:04699f9c5aeba7ffdb62ec976e44ff43ecc16f120b64ee36e86da623feeab9a2",
        "method": null,
        "_path": "superduper.components.model.ObjectModel",
        "version": 0
      },
      "Listener:chunker": {
        "upstream": null,
        "cache": true,
        "status": "ready",
        "build_variables": null,
        "build_template": null,
        "cdc_table": "<var:table_name>",
        "key": "file",
        "model": "?ObjectModel:chunk",
        "predict_kwargs": {},
        "select": {
          "_path": "superduper.base.query.parse_query",
          "documents": [],
          "query": "<var:table_name>"
        },
        "flatten": true,
        "_path": "superduper.components.listener.Listener",
        "version": 0
      },
      "OpenAIEmbedding:embedding": {
        "upstream": null,
        "cache": true,
        "status": "ready",
        "build_variables": null,
        "build_template": null,
        "datatype": "vector[float:1536]",
        "model_update_kwargs": {},
        "predict_kwargs": {},
        "compute_kwargs": {},
        "validation": null,
        "metric_values": {},
        "num_workers": 0,
        "serve": false,
        "trainer": null,
        "model": "<var:embedding_model>",
        "max_batch_size": 8,
        "postprocess": null,
        "openai_api_key": null,
        "openai_api_base": null,
        "client_kwargs": {},
        "signature": "singleton",
        "batch_size": 100,
        "_path": "superduper_openai.model.OpenAIEmbedding",
        "version": 0
      },
      "Listener:embedding": {
        "upstream": null,
        "cache": true,
        "status": "ready",
        "build_variables": null,
        "build_template": null,
        "cdc_table": "<var:output_prefix>chunker__?(Listener:chunker.uuid)",
        "key": "<var:output_prefix>chunker__?(Listener:chunker.uuid).txt",
        "model": "?OpenAIEmbedding:embedding",
        "predict_kwargs": {},
        "select": {
          "_path": "superduper.base.query.parse_query",
          "documents": [],
          "query": "<var:output_prefix>chunker__?(Listener:chunker.uuid).select()"
        },
        "flatten": false,
        "_path": "superduper.components.listener.Listener",
        "version": 0
      },
      "VectorIndex:vector-index": {
        "upstream": null,
        "cache": true,
        "status": "ready",
        "build_variables": null,
        "build_template": null,
        "cdc_table": "<var:output_prefix>embedding__?(Listener:embedding.uuid)",
        "indexing_listener": "?Listener:embedding",
        "compatible_listener": null,
        "measure": "cosine",
        "metric_values": {},
        "_path": "superduper.components.vector_index.VectorIndex",
        "version": 0
      },
      "OpenAIChatCompletion:llm-openai": {
        "upstream": null,
        "cache": true,
        "status": "ready",
        "build_variables": null,
        "build_template": null,
        "datatype": "str",
        "model_update_kwargs": {},
        "predict_kwargs": {},
        "compute_kwargs": {},
        "validation": null,
        "metric_values": {},
        "num_workers": 0,
        "serve": false,
        "trainer": null,
        "model": "<var:llm_model>",
        "max_batch_size": 8,
        "postprocess": null,
        "openai_api_key": null,
        "openai_api_base": null,
        "client_kwargs": {},
        "signature": "singleton",
        "batch_size": 1,
        "prompt": "",
        "_path": "superduper_openai.model.OpenAIChatCompletion",
        "version": 0
      },
      "Plugin:plugin-utils_py": {
        "upstream": null,
        "cache": true,
        "status": "ready",
        "build_variables": null,
        "build_template": null,
        "path": "&:file:fc779c3a93a4b686c2b46a88abbae91b766cc82a53fbbf653636c7262913198e",
        "cache_path": "~/.superduper/plugins",
        "_path": "superduper.components.plugin.Plugin",
        "version": 0
      },
      "Processor:processor": {
        "upstream": [
          "?Plugin:plugin-utils_py"
        ],
        "cache": true,
        "status": "ready",
        "build_variables": null,
        "build_template": null,
        "datatype": "str",
        "model_update_kwargs": {},
        "predict_kwargs": {},
        "compute_kwargs": {},
        "validation": null,
        "metric_values": {},
        "num_workers": 0,
        "serve": false,
        "trainer": null,
        "chunk_key": "<var:output_prefix>chunker__?(Listener:chunker.uuid)",
        "split_image_key": "<var:output_prefix>split_image__?(Listener:split_image.uuid)",
        "_path": "utils.Processor",
        "version": 0
      },
      "Rag:rag": {
        "upstream": [
          "?VectorIndex:vector-index"
        ],
        "cache": true,
        "status": "ready",
        "build_variables": null,
        "build_template": null,
        "datatype": "str",
        "model_update_kwargs": {},
        "predict_kwargs": {},
        "compute_kwargs": {},
        "validation": null,
        "metric_values": {},
        "num_workers": 0,
        "serve": false,
        "trainer": null,
        "llm_model": "?OpenAIChatCompletion:llm-openai",
        "prompt_template": "<var:prompt_template>",
        "processor": "?Processor:processor",
        "vector_index": "?VectorIndex:vector-index",
        "_path": "__main__.Rag",
        "version": 0
      }
    }
  },
  "template_variables": [
    "table_name",
    "prompt_template",
    "llm_model",
    "embedding_model"
  ],
  "types": {
    "prompt_template": {
      "type": "str",
      "default": "The following is a document and question\nOnly provide a very concise answer\nContext:\n\n{context}\n\nHere's the question:{query}\nanswer:"
    },
    "table_name": {
      "type": "str",
      "default": "sample_pdf_rag"
    },
    "llm_model": {
      "type": "str",
      "default": "gpt-3.5-turbo"
    },
    "embedding_model": {
      "type": "str",
      "default": "text-embedding-ada-002"
    }
  },
  "schema": null,
  "blobs": "&:blob:f712148d07b212a064d0925cf94febc26d5b14d2ff5ab149440eaa4433d20769",
  "files": {
    "fc779c3a93a4b686c2b46a88abbae91b766cc82a53fbbf653636c7262913198e": "&:file:fc779c3a93a4b686c2b46a88abbae91b766cc82a53fbbf653636c7262913198e"
  },
  "requirements": null,
  "default_tables": [
    "?Table:sample_pdf_rag"
  ],
  "_path": "superduper.components.template.Template",
  "version": null,
  "_builds": {
    "RemoteData:sample_pdfs": {
      "upstream": null,
      "cache": true,
      "status": null,
      "build_variables": null,
      "build_template": null,
      "getter": "&:blob:9fa377f69204207c13df9c46a43e73bc563038a42f3ac65cda21a346b8131c96",
      "_path": "superduper.components.dataset.RemoteData",
      "version": null
    },
    "Table:sample_pdf_rag": {
      "upstream": null,
      "cache": true,
      "status": null,
      "build_variables": null,
      "build_template": null,
      "fields": {
        "url": "str",
        "file": "file"
      },
      "primary_id": "id",
      "data": "?RemoteData:sample_pdfs",
      "path": null,
      "component": false,
      "_path": "superduper.components.table.Table",
      "version": null
    }
  }
}