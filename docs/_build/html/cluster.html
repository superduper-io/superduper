<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Setting up a SuperDuperDB cluster &mdash; SuperDuperDB  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Deep dive into SuperDuperDB models" href="models.html" />
    <link rel="prev" title="SuperDuperDB Concepts" href="concepts.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> SuperDuperDB
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview of SuperDuperDB</a></li>
<li class="toctree-l1"><a class="reference internal" href="concepts.html">SuperDuperDB Concepts</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Setting up a SuperDuperDB cluster</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#components">Components</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#client">Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mongodb">MongoDB</a></li>
<li class="toctree-l3"><a class="reference internal" href="#master-vector-search">Master/ Vector Search</a></li>
<li class="toctree-l3"><a class="reference internal" href="#job-master">Job-master</a></li>
<li class="toctree-l3"><a class="reference internal" href="#job-worker">Job-worker</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#basic-local-cluster-setup">Basic local cluster setup</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="models.html">Deep dive into SuperDuperDB models</a></li>
<li class="toctree-l1"><a class="reference internal" href="semantic_indexes.html">Deep dive into semantic indexes</a></li>
<li class="toctree-l1"><a class="reference internal" href="training.html">Model training with SuperDuperDB</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/index.html">Notebook examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="full_usage.html">Full usage</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SuperDuperDB</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">Setting up a SuperDuperDB cluster</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/cluster.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="setting-up-a-superduperdb-cluster">
<h1>Setting up a SuperDuperDB cluster<a class="headerlink" href="#setting-up-a-superduperdb-cluster" title="Permalink to this heading"></a></h1>
<p>The exact setup of your SuperDuperDB cluster will depend on the requires of the use-cases you
plan to execute with the cluster. Factors to consider will be:</p>
<ul class="simple">
<li><p>Latency</p></li>
<li><p>Where the MongoDB deployment is located</p></li>
<li><p>Whether you want to scale the cluster according to demand</p></li>
<li><p>What hardware you’d like to run</p></li>
<li><p>And more…</p></li>
</ul>
<section id="components">
<h2>Components<a class="headerlink" href="#components" title="Permalink to this heading"></a></h2>
<p>The basic topology of a SuperDuperDB cluster is given in the graphic below:</p>
<a class="reference internal image-reference" href="_images/architecture.png"><img alt="_images/architecture.png" src="_images/architecture.png" style="width: 80%;" /></a>
<section id="client">
<h3>Client<a class="headerlink" href="#client" title="Permalink to this heading"></a></h3>
<p>The client is analagous to the client used in MongoDB. This is the programmer’s interface to
the SuperDuperDB cluster and provides a unified user-experience very similar to the MongoDB
user experience.</p>
</section>
<section id="mongodb">
<h3>MongoDB<a class="headerlink" href="#mongodb" title="Permalink to this heading"></a></h3>
<p>This is a standard MongoDB deployment. The deployment can either sit in the same infrastructure
as the remained of the SuperDuperDB, or it can be situated remotely. Performance and latency
concerns here will play a role in which version works best and is most convenient.</p>
</section>
<section id="master-vector-search">
<h3>Master/ Vector Search<a class="headerlink" href="#master-vector-search" title="Permalink to this heading"></a></h3>
<p>This node returns real time semantic index search outputs to the client. The node loads
model outputs which are of vector or tensor type, and creates an in-memory search index over
them.</p>
</section>
<section id="job-master">
<h3>Job-master<a class="headerlink" href="#job-master" title="Permalink to this heading"></a></h3>
<p>This node schedules jobs to run on the job-workers. These jobs compute model outputs and
also run training to create new models.</p>
</section>
<section id="job-worker">
<h3>Job-worker<a class="headerlink" href="#job-worker" title="Permalink to this heading"></a></h3>
<p>These nodes perform the long computations necessary to update model outputs when new data
come in, and also perform model training for models which are set up to be trained on creation.</p>
</section>
</section>
<section id="basic-local-cluster-setup">
<h2>Basic local cluster setup<a class="headerlink" href="#basic-local-cluster-setup" title="Permalink to this heading"></a></h2>
<p>The following <code class="docutils literal notranslate"><span class="pre">config.json</span></code> and <code class="docutils literal notranslate"><span class="pre">supervisord.conf</span></code> configuration runs a test cluster
on the <code class="docutils literal notranslate"><span class="pre">localhost</span></code>:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;remote&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;master&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;host&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;port&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5001</span><span class="w"></span>
<span class="w">  </span><span class="p">},</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;jobs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;host&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;port&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5002</span><span class="w"></span>
<span class="w">  </span><span class="p">},</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;redis&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;host&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;port&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">6379</span><span class="w"></span>
<span class="w">  </span><span class="p">},</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;mongodb&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;host&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;port&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">27017</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">supervisord</span><span class="p">]</span>

<span class="n">logfile</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
<span class="n">logfile_maxbytes</span><span class="o">=</span><span class="mi">0</span>

<span class="p">[</span><span class="n">program</span><span class="p">:</span><span class="n">master</span><span class="p">]</span>

<span class="n">command</span><span class="o">=/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;python3 -m superduperdb.servers.master $(cat config.json | jq .master.port)&quot;</span>
<span class="n">process_name</span><span class="o">=%</span><span class="p">(</span><span class="n">program_name</span><span class="p">)</span><span class="n">s_</span><span class="o">%</span><span class="p">(</span><span class="n">process_num</span><span class="p">)</span><span class="n">s</span>
<span class="n">numprocs</span><span class="o">=</span><span class="mi">1</span>
<span class="n">stdout_logfile</span><span class="o">=</span><span class="n">logs</span><span class="o">/</span><span class="n">master</span><span class="o">.</span><span class="n">out</span>
<span class="n">stderr_logfile</span><span class="o">=</span><span class="n">logs</span><span class="o">/</span><span class="n">master</span><span class="o">.</span><span class="n">out</span>
<span class="n">autorestart</span><span class="o">=</span><span class="n">false</span>
<span class="n">startretries</span><span class="o">=</span><span class="mi">1</span>

<span class="p">[</span><span class="n">program</span><span class="p">:</span><span class="n">jobs</span><span class="o">-</span><span class="n">master</span><span class="p">]</span>

<span class="n">command</span><span class="o">=/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;python3 -m superduperdb.servers.jobs $(cat config.json | jq .hash_set.port)&quot;</span>
<span class="n">process_name</span><span class="o">=%</span><span class="p">(</span><span class="n">program_name</span><span class="p">)</span><span class="n">s_</span><span class="o">%</span><span class="p">(</span><span class="n">process_num</span><span class="p">)</span><span class="n">s</span>
<span class="n">numprocs</span><span class="o">=</span><span class="mi">1</span>
<span class="n">stdout_logfile</span><span class="o">=</span><span class="n">logs</span><span class="o">/</span><span class="n">jobs</span><span class="o">-</span><span class="n">master</span><span class="o">.</span><span class="n">out</span>
<span class="n">stderr_logfile</span><span class="o">=</span><span class="n">logs</span><span class="o">/</span><span class="n">jobs</span><span class="o">-</span><span class="n">master</span><span class="o">.</span><span class="n">out</span>
<span class="n">autorestart</span><span class="o">=</span><span class="n">false</span>
<span class="n">startretries</span><span class="o">=</span><span class="mi">1</span>

<span class="p">[</span><span class="n">program</span><span class="p">:</span><span class="n">jobs</span><span class="o">-</span><span class="n">worker</span><span class="p">]</span>

<span class="n">command</span><span class="o">=/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;rq worker -v --url redis://:@localhost:$(cat config.json | jq .redis.port)&quot;</span>
<span class="n">process_name</span><span class="o">=%</span><span class="p">(</span><span class="n">program_name</span><span class="p">)</span><span class="n">s_</span><span class="o">%</span><span class="p">(</span><span class="n">process_num</span><span class="p">)</span><span class="n">s</span>
<span class="n">numprocs</span><span class="o">=</span><span class="mi">2</span>
<span class="n">stdout_logfile</span><span class="o">=</span><span class="n">logs</span><span class="o">/</span><span class="n">jobs</span><span class="o">-</span><span class="n">worker</span><span class="o">.</span><span class="n">out</span>
<span class="n">stderr_logfile</span><span class="o">=</span><span class="n">logs</span><span class="o">/</span><span class="n">jobs</span><span class="o">-</span><span class="n">worker</span><span class="o">.</span><span class="n">out</span>
<span class="n">autorestart</span><span class="o">=</span><span class="n">false</span>
<span class="n">startretries</span><span class="o">=</span><span class="mi">1</span>

<span class="p">[</span><span class="n">program</span><span class="p">:</span><span class="n">redis</span><span class="p">]</span>

<span class="n">command</span><span class="o">=/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;redis-server --port $(cat config.json | jq .redis.port)&quot;</span>
<span class="n">process_name</span><span class="o">=%</span><span class="p">(</span><span class="n">program_name</span><span class="p">)</span><span class="n">s_</span><span class="o">%</span><span class="p">(</span><span class="n">process_num</span><span class="p">)</span><span class="n">s</span>
<span class="n">numprocs</span><span class="o">=</span><span class="mi">1</span>
<span class="n">stdout_logfile</span><span class="o">=</span><span class="n">logs</span><span class="o">/</span><span class="n">redis</span><span class="o">.</span><span class="n">out</span>
<span class="n">stderr_logfile</span><span class="o">=</span><span class="n">logs</span><span class="o">/</span><span class="n">redis</span><span class="o">.</span><span class="n">out</span>
<span class="n">autorestart</span><span class="o">=</span><span class="n">false</span>
<span class="n">startretries</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
<p>The cluster may be started with this command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">OBJC_DISABLE_INITIALIZE_FORK_SAFETY</span><span class="o">=</span>YES supervisord -n
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="concepts.html" class="btn btn-neutral float-left" title="SuperDuperDB Concepts" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="models.html" class="btn btn-neutral float-right" title="Deep dive into SuperDuperDB models" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Duncan Blythe duncan@superduperdb.com.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>