{
  "_base": "?rag",
  "_builds": {
    "datatype:pickle": {
      "_path": "superduper.components.datatype.get_serializer",
      "method": "pickle",
      "encodable": "artifact"
    },
    "692420d66e95035ee4c3326723bb6b28a69a7e65": {
      "_path": "superduper.components.datatype.Artifact",
      "datatype": "?datatype:pickle",
      "blob": "&:blob:692420d66e95035ee4c3326723bb6b28a69a7e65"
    },
    "rag": {
      "_path": "superduper.components.template.Template",
      "template": {
        "_base": "?rag-app",
        "_builds": {
          "datatype:dill_lazy": {
            "_path": "superduper.components.datatype.get_serializer",
            "method": "dill",
            "encodable": "lazy_artifact"
          },
          "24c1b3fe6156ed17ba40678c93367d4b926a28c8": {
            "_path": "superduper.components.datatype.LazyArtifact",
            "datatype": "?datatype:dill_lazy",
            "blob": "&:blob:24c1b3fe6156ed17ba40678c93367d4b926a28c8"
          },
          "model:chunker": {
            "_path": "superduper.components.model.ObjectModel",
            "object": "?24c1b3fe6156ed17ba40678c93367d4b926a28c8"
          },
          "listener:chunker": {
            "_path": "superduper.components.listener.Listener",
            "cdc_table": "<var:table_name>",
            "key": "x",
            "model": "?model:chunker",
            "flatten": true
          },
          "datatype:vector[1024]": {
            "_path": "superduper.components.vector_index.vector",
            "shape": [
              1024
            ]
          },
          "model:text-embedding-ada-002": {
            "_path": "superduper_openai.model.OpenAIEmbedding",
            "datatype": "?datatype:vector[1024]",
            "model": "text-embedding-ada-002",
            "shape": [
              1536
            ]
          },
          "datatype:dill": {
            "_path": "superduper.components.datatype.get_serializer",
            "method": "dill",
            "encodable": "artifact"
          },
          "4ed1d33cd20e79786ca10fcf8b276a88af72c713": {
            "_path": "superduper.components.datatype.Artifact",
            "datatype": "?datatype:dill",
            "blob": "&:blob:4ed1d33cd20e79786ca10fcf8b276a88af72c713"
          },
          "model:sentence-transformers-embedding": {
            "_path": "superduper_sentence_transformers.model.SentenceTransformer",
            "datatype": "?datatype:vector[1024]",
            "predict_kwargs": {
              "show_progress_bar": true
            },
            "model": "BAAI/bge-small-en",
            "postprocess": "?4ed1d33cd20e79786ca10fcf8b276a88af72c713"
          },
          "model:embedding": {
            "_path": "superduper.components.model.ModelRouter",
            "models": {
              "openai_embedding": "?model:text-embedding-ada-002",
              "sentence_transformers_embedding": "?model:sentence-transformers-embedding"
            },
            "model": "<var:embedding_model>"
          },
          "listener:embedding-listener": {
            "_path": "superduper.components.listener.Listener",
            "upstream": [
              "?listener:chunker",
              "?listener:chunker"
            ],
            "cdc_table": "_outputs__chunker__?(listener:chunker.uuid)",
            "key": "_outputs__chunker__?(listener:chunker.uuid)",
            "model": "?model:embedding"
          },
          "vector_index:vector-index": {
            "_path": "superduper.components.vector_index.VectorIndex",
            "cdc_table": "_outputs__embedding-listener__?(listener:embedding-listener.uuid)",
            "indexing_listener": "?listener:embedding-listener"
          },
          "outputs-chunker-?(listener:chunker.uuid)-select-like-outputs-chunker-?(listener:chunker.uuid)-var-query-vector-index-vector-index-n-5": {
            "_path": "superduper_mongodb.query.parse_query",
            "documents": [
              {
                "_outputs__chunker__?(listener:chunker.uuid)": "<var:query>"
              }
            ],
            "query": "_outputs__chunker__?(listener:chunker.uuid).select().like(documents[0], vector_index=\"vector-index\", n=5)"
          },
          "model:llm-openai": {
            "_path": "superduper_openai.model.OpenAIChatCompletion",
            "model": "gpt-3.5-turbo"
          },
          "model:llm-vllm": {
            "_path": "superduper_vllm.model.VllmCompletion",
            "predict_kwargs": {
              "max_tokens": 1024,
              "temperature": 0.8
            },
            "compute_kwargs": {
              "num_gpus": 1
            },
            "vllm_params": {
              "model": "TheBloke/Mistral-7B-Instruct-v0.2-AWQ",
              "gpu_memory_utilization": 0.7,
              "max_model_len": 1024,
              "quantization": "awq"
            }
          },
          "model:llm-llamacpp": {
            "_path": "superduper_llamacpp.model.LlamaCpp",
            "model_name_or_path": "mistral-7b-instruct-v0.2.Q4_K_M.gguf"
          },
          "model:llm": {
            "_path": "superduper.components.model.ModelRouter",
            "models": {
              "openai": "?model:llm-openai",
              "anthropic": "?model:llm-vllm",
              "vllm": "?model:llm-vllm",
              "llamacpp": "?model:llm-llamacpp"
            },
            "model": "<var:llm_model>"
          },
          "model:rag-model": {
            "_path": "superduper.components.model.RAGModel",
            "prompt_template": "Use the following context snippets, these snippets are not ordered!, Answer the question based on this context.\n{context}\n\nHere's the question: {query}",
            "select": "?outputs-chunker-?(listener:chunker.uuid)-select-like-outputs-chunker-?(listener:chunker.uuid)-var-query-vector-index-vector-index-n-5",
            "key": "_outputs__chunker__?(listener:chunker.uuid)",
            "llm": "?model:llm"
          },
          "rag-app": {
            "_path": "superduper.components.application.Application",
            "components": [
              "?listener:chunker",
              "?vector_index:vector-index",
              "?model:rag-model"
            ],
            "_literals": [
              "template"
            ]
          }
        }
      },
      "template_variables": [
        "llm_model",
        "embedding_model",
        "table_name"
      ],
      "types": {
        "llm_model": {
          "type": "str",
          "choices": [
            "openai",
            "anthropic",
            "vllm",
            "llamacpp"
          ],
          "default": "openai"
        },
        "embedding_model": {
          "type": "str",
          "choices": [
            "openai",
            "sentence_transformers"
          ],
          "default": "openai"
        },
        "table_name": {
          "type": "str",
          "default": "_sample_rag"
        }
      },
      "data": "?692420d66e95035ee4c3326723bb6b28a69a7e65",
      "_literals": [
        "template"
      ]
    }
  },
  "_files": {}
}