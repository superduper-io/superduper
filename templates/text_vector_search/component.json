{
  "_path": "superduper.components.template.Template",
  "identifier": "text_vector_search",
  "upstream": null,
  "plugins": null,
  "cache": true,
  "build_variables": null,
  "build_template": null,
  "template": {
    "_base": "?text-vector-search-app-<var:table_name>",
    "_builds": {
      "str": {
        "_path": "superduper.components.schema.FieldType"
      },
      "model:chunk_model": {
        "_object": "&:blob:85d22fdc19a5621624255e5a6a0c9427d82370fd",
        "upstream": null,
        "plugins": null,
        "cache": true,
        "build_variables": null,
        "build_template": null,
        "signature": "singleton",
        "datatype": "?str",
        "output_schema": null,
        "model_update_kwargs": {},
        "predict_kwargs": {},
        "compute_kwargs": {},
        "validation": null,
        "metric_values": {},
        "num_workers": 0,
        "serve": false,
        "trainer": null,
        "deploy": false,
        "chunk_size": 200
      },
      "sample-text-vector-search-select": {
        "_path": "superduper_<var:data_backend>.query.parse_query",
        "documents": [],
        "query": "<var:table_name>.select()"
      },
      "listener:chunker_<var:table_name>": {
        "_path": "superduper.components.listener.Listener",
        "upstream": null,
        "plugins": null,
        "cache": true,
        "build_variables": null,
        "build_template": null,
        "key": "x",
        "model": "?model:chunk_model",
        "predict_kwargs": {},
        "select": "?sample-text-vector-search-select",
        "flatten": true
      },
      "datatype:vector[1536]": {
        "_path": "superduper.components.datatype.Vector",
        "upstream": null,
        "plugins": null,
        "cache": true,
        "build_variables": null,
        "build_template": null,
        "shape": [
          1536
        ],
        "dtype": "float64"
      },
      "model:text-embedding-ada-002": {
        "_path": "superduper_openai.model.OpenAIEmbedding",
        "upstream": null,
        "plugins": null,
        "cache": true,
        "build_variables": null,
        "build_template": null,
        "signature": "singleton",
        "datatype": "?datatype:vector[1536]",
        "output_schema": null,
        "model_update_kwargs": {},
        "predict_kwargs": {},
        "compute_kwargs": {},
        "validation": null,
        "metric_values": {},
        "num_workers": 0,
        "serve": false,
        "trainer": null,
        "deploy": false,
        "model": "text-embedding-ada-002",
        "max_batch_size": 8,
        "postprocess": null,
        "openai_api_key": null,
        "openai_api_base": null,
        "client_kwargs": {},
        "batch_size": 100
      },
      "datatype:vector[1024]": {
        "_path": "superduper.components.datatype.Vector",
        "upstream": null,
        "plugins": null,
        "cache": true,
        "build_variables": null,
        "build_template": null,
        "shape": [
          1024
        ],
        "dtype": "float64"
      },
      "model:sentence-transformers-embedding": {
        "_path": "superduper_sentence_transformers.model.SentenceTransformer",
        "preferred_devices": [
          "cuda",
          "mps",
          "cpu"
        ],
        "device": "cpu",
        "upstream": null,
        "plugins": null,
        "cache": true,
        "build_variables": null,
        "build_template": null,
        "signature": "singleton",
        "datatype": "?datatype:vector[1024]",
        "output_schema": null,
        "model_update_kwargs": {},
        "predict_kwargs": {
          "show_progress_bar": true
        },
        "compute_kwargs": {},
        "validation": null,
        "metric_values": {},
        "num_workers": 0,
        "serve": false,
        "trainer": null,
        "deploy": false,
        "model": "BAAI/bge-small-en",
        "preprocess": null,
        "postprocess": "&:blob:7e3797ba5e8838fba8c62d6fe57f2cfe04a96e95"
      },
      "model:embedding": {
        "_path": "superduper.components.model.ModelRouter",
        "upstream": null,
        "plugins": null,
        "cache": true,
        "build_variables": null,
        "build_template": null,
        "signature": "*args,**kwargs",
        "datatype": "?datatype:vector[1536]",
        "output_schema": null,
        "model_update_kwargs": {},
        "predict_kwargs": {},
        "compute_kwargs": {},
        "validation": null,
        "metric_values": {},
        "num_workers": 0,
        "serve": false,
        "trainer": null,
        "deploy": false,
        "models": {
          "openai": "?model:text-embedding-ada-002",
          "sentence_transformers": "?model:sentence-transformers-embedding"
        },
        "model": "openai"
      },
      "outputs-chunker-sample-text-vector-search-?(listener:chunker_<var:table_name>.uuid)-select": {
        "_path": "superduper_<var:data_backend>.query.parse_query",
        "documents": [],
        "query": "<var:output_prefix>chunker_<var:table_name>__?(listener:chunker_<var:table_name>.uuid).select()"
      },
      "listener:embedding-listener-<var:table_name>": {
        "_path": "superduper.components.listener.Listener",
        "upstream": [
          "?listener:chunker_<var:table_name>"
        ],
        "plugins": null,
        "cache": true,
        "build_variables": null,
        "build_template": null,
        "key": "<var:output_prefix>chunker_<var:table_name>__?(listener:chunker_<var:table_name>.uuid)",
        "model": "?model:embedding",
        "predict_kwargs": {},
        "select": "?outputs-chunker-sample-text-vector-search-?(listener:chunker_<var:table_name>.uuid)-select",
        "flatten": false
      },
      "vector_index:vector-index-<var:table_name>": {
        "_path": "superduper.components.vector_index.VectorIndex",
        "upstream": null,
        "plugins": null,
        "cache": true,
        "build_variables": null,
        "build_template": null,
        "indexing_listener": "?listener:embedding-listener-<var:table_name>",
        "compatible_listener": null,
        "measure": "cosine",
        "metric_values": {}
      },
      "text-vector-search-app-<var:table_name>": {
        "_path": "superduper.components.application.Application",
        "upstream": null,
        "plugins": null,
        "cache": true,
        "build_variables": null,
        "build_template": null,
        "components": [
          "?listener:chunker_<var:table_name>",
          "?vector_index:vector-index-<var:table_name>"
        ],
        "namespace": [
          {
            "type_id": "listener",
            "identifier": "chunker_<var:table_name>"
          },
          {
            "type_id": "vector_index",
            "identifier": "vector-index-<var:table_name>"
          },
          {
            "type_id": "model",
            "identifier": "chunk_model"
          },
          {
            "type_id": "table",
            "identifier": "<var:output_prefix>chunker_<var:table_name>__?(listener:chunker_<var:table_name>.uuid)"
          },
          {
            "type_id": "schema",
            "identifier": "_schema/<var:output_prefix>chunker_<var:table_name>__?(listener:chunker_<var:table_name>.uuid)"
          },
          {
            "type_id": "listener",
            "identifier": "embedding-listener-<var:table_name>"
          },
          {
            "type_id": "model",
            "identifier": "embedding"
          },
          {
            "type_id": "table",
            "identifier": "<var:output_prefix>embedding-listener-<var:table_name>__?(listener:embedding-listener-<var:table_name>.uuid)"
          },
          {
            "type_id": "datatype",
            "identifier": "vector[1536]"
          },
          {
            "type_id": "model",
            "identifier": "text-embedding-ada-002"
          },
          {
            "type_id": "model",
            "identifier": "sentence-transformers-embedding"
          },
          {
            "type_id": "datatype",
            "identifier": "vector[1024]"
          },
          {
            "type_id": "schema",
            "identifier": "_schema/<var:output_prefix>embedding-listener-<var:table_name>__?(listener:embedding-listener-<var:table_name>.uuid)"
          }
        ],
        "link": null,
        "_literals": [
          "template"
        ]
      }
    }
  },
  "template_variables": [
    "embedding_model",
    "table_name",
    "data_backend"
  ],
  "types": {
    "embedding_model": {
      "type": "str",
      "choices": [
        "openai",
        "sentence_transformers"
      ],
      "default": "openai"
    },
    "table_name": {
      "type": "str",
      "default": "sample_text_vector_search"
    },
    "data_backend": {
      "type": "mongodb",
      "choices": [
        "mongodb",
        "ibis"
      ],
      "default": "mongodb"
    }
  },
  "schema": null,
  "blobs": null,
  "files": null,
  "requirements": null,
  "default_tables": [
    "?table:sample_text_vector_search"
  ],
  "staged_file": null,
  "queries": [
    "?query_template:vector_search"
  ],
  "_literals": [
    "template"
  ],
  "_builds": {
    "str": {
      "_path": "superduper.components.schema.FieldType",
      "uuid": "a1988c70333743bd"
    },
    "schema:sample_text_vector_search/schema": {
      "_path": "superduper.components.schema.Schema",
      "uuid": "96d31af11c5d4ff2",
      "upstream": null,
      "plugins": null,
      "cache": true,
      "build_variables": null,
      "build_template": null,
      "fields": {
        "x": "?str",
        "_fold": "?str"
      }
    },
    "dataset:superduper-docs": {
      "_path": "superduper.components.dataset.RemoteData",
      "uuid": "8c7bc3a98de54012",
      "upstream": null,
      "plugins": null,
      "cache": true,
      "build_variables": null,
      "build_template": null,
      "getter": "&:blob:f868603eb46e70be26e589af755bc4141ada2535"
    },
    "table:sample_text_vector_search": {
      "_path": "superduper.components.table.Table",
      "uuid": "0d3ea2d96c434c2e",
      "upstream": null,
      "plugins": null,
      "cache": true,
      "build_variables": null,
      "build_template": null,
      "schema": "?schema:sample_text_vector_search/schema",
      "primary_id": "id",
      "data": "?dataset:superduper-docs"
    },
    "query_template:vector_search": {
      "_path": "superduper.components.template.QueryTemplate",
      "uuid": "2aea6aa8054a4182",
      "upstream": null,
      "plugins": null,
      "cache": true,
      "build_variables": null,
      "build_template": null,
      "template": {
        "_path": "superduper_<var:data_backend>.query.parse_query",
        "documents": [
          {
            "<var:output_prefix>chunker_<var:table_name>": "<var:search_term>"
          }
        ],
        "identifier": "outputs-chunker-sample-text-vector-search-like-outputs-chunker-sample-text-vector-search-tell-me-about-the-use-of-pylance-and-vector-search-n-10-vector-index-vector-index-sample-text-vector-search-select",
        "query": "<var:output_prefix>chunker_<var:table_name>.like(documents[0], n=10, vector_index=\"vector-index-<var:table_name>\").select()",
        "_builds": {},
        "_files": {},
        "_blobs": {}
      },
      "template_variables": [
        "data_backend",
        "output_prefix",
        "search_term",
        "table_name"
      ],
      "types": {
        "search_term": {
          "type": "str",
          "default": "enter your question here..."
        },
        "table_name": {
          "type": "str",
          "default": "sample_text_vector_search"
        },
        "data_backend": {
          "type": "mongodb",
          "choices": [
            "mongodb",
            "ibis"
          ],
          "default": "mongodb"
        }
      },
      "schema": null,
      "blobs": null,
      "files": null,
      "_literals": [
        "template"
      ]
    }
  },
  "_files": {}
}